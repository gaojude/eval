/**
 * Agent interface and common types for all agents.
 */

import type { ModelTier, SetupFunction } from '../types.js';

/**
 * Common options for all agents.
 */
export interface AgentRunOptions {
  /** The prompt/task for the agent */
  prompt: string;
  /** Model to use (agent-specific) */
  model: ModelTier;
  /** Timeout in milliseconds */
  timeout: number;
  /** API key for the agent */
  apiKey: string;
  /** Optional setup function to run before agent */
  setup?: SetupFunction;
  /** npm scripts to run after agent completes */
  scripts?: string[];
}

/**
 * Result from running a script.
 */
export interface ScriptResult {
  success: boolean;
  output: string;
}

/**
 * Result of an agent run.
 */
export interface AgentRunResult {
  /** Whether the run was successful */
  success: boolean;
  /** Raw output from the agent (stdout/stderr) */
  output: string;
  /** Structured transcript (JSONL format for Claude, JSON for Codex) */
  transcript?: string;
  /** Error message if failed */
  error?: string;
  /** Duration in milliseconds */
  duration: number;
  /** Test result (EVAL.ts always runs) */
  testResult?: ScriptResult;
  /** Results from configured scripts */
  scriptsResults?: Record<string, ScriptResult>;
  /** Sandbox ID for debugging */
  sandboxId?: string;
  /** Files generated by the agent */
  generatedFiles?: Record<string, string>;
}

/**
 * Agent interface that all agents must implement.
 */
export interface Agent {
  /** Unique identifier for the agent */
  name: string;

  /** Human-readable display name */
  displayName: string;

  /** Run the agent on a fixture */
  run(fixturePath: string, options: AgentRunOptions): Promise<AgentRunResult>;

  /** Get agent-specific environment variable name for API key */
  getApiKeyEnvVar(): string;

  /** Get the default model for this agent */
  getDefaultModel(): ModelTier;
}
